services:
  openclaw-gateway:
    image: ghcr.io/openclaw/openclaw:latest
    container_name: ${OPENCLAW_CONTAINER_NAME:-openclaw}
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OLLAMA_BASE_URL: ${OLLAMA_URL}
    volumes:
      - ${DATA_PATH}/config:/home/node/.openclaw
      - ${DATA_PATH}/workspace:/home/node/.openclaw/workspace
    labels:
      - joyride.host.name=${OPENCLAW_CONTAINER_NAME:-openclaw}.${HOST_DOMAIN}
      - traefik.docker.network=traefik
      - traefik.enable=${OPENCLAW_TRAEFIK_ENABLE:-true}
      - traefik.http.routers.openclaw.entrypoints=websecure
      - traefik.http.routers.openclaw.rule=Host(`${OPENCLAW_CONTAINER_NAME:-openclaw}.${HOST_DOMAIN}`)
      - traefik.http.services.openclaw.loadbalancer.server.port=18789
      - com.centurylinklabs.watchtower.enable=${OPENCLAW_WATCHTOWER_ENABLE:-true}
      - autoheal=${OPENCLAW_AUTOHEAL:-true}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - traefik
      - default
    init: true
    restart: unless-stopped
    command:
      - "node"
      - "dist/index.js"
      - "gateway"
      - "--bind"
      - "lan"
      - "--port"
      - "18789"
      - "--allow-unconfigured"

networks:
  traefik:
    external: true
  default:
    name: openclaw-network
